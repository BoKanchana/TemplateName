name: PR Slash Command Trigger

on:
  issue_comment:
    types: [created]

permissions:
  issues: write
  pull-requests: write

jobs:
  test-slash-command:
    if: |
      github.event.issue.pull_request &&
      startsWith(github.event.comment.body, 'jenkins rebuild')
    runs-on: ubuntu-latest
    steps:
      - name: Reply on pull request comment
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = context.issue.number;
            const sender = context.actor;
            const payload = JSON.stringify(context.payload, null, 2);
            // เนื่องจาก comment ใน GitHub รองรับ string ได้สูงสุด ~65,535 ตัวอักษร
            // ควรตัด payload ถ้ายาวเกินไป
            const safePayload = payload.length > 60000 ? payload.slice(0, 60000) + '\n...truncated...' : payload;
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              body: [
                `@${sender} triggerd /run-e2e. Payload from event:`,
                '',
                '```json',
                safePayload,
                '```'
              ].join('\n')
            });